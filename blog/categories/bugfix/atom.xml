<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: bugfix | xixitalk's snippet]]></title>
  <link href="http://xixitalk.github.io/blog/categories/bugfix/atom.xml" rel="self"/>
  <link href="http://xixitalk.github.io/"/>
  <updated>2016-07-09T11:36:07+08:00</updated>
  <id>http://xixitalk.github.io/</id>
  <author>
    <name><![CDATA[xixitalk]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[UINT32引起的死循环]]></title>
    <link href="http://xixitalk.github.io/blog/2016/07/09/dead-loop-UINT32/"/>
    <updated>2016-07-09T18:02:35+08:00</updated>
    <id>http://xixitalk.github.io/blog/2016/07/09/dead-loop-UINT32</id>
    <content type="html"><![CDATA[<p>UINT32 引起的死循环</p>

<!--more-->

<p>上周出差定位一个死循环。一个函数进行一个信号量的初始化，每次进行一次业务都要调用这个函数初始化，这个函数作用是保障初始化后信号量初始化值为<code>SEM_INIT_NUM</code>，但因为<code>UINT32</code>的关系出现死循环了。代码如下：</p>

<script src="https://gist.github.com/xixitalk/5c176a78a8743465061ef15ab5f9a248.js"></script>

<p>出现问题的时候，<code>semCount</code>为4，而宏<code>SEM_INIT_NUM</code>为3，造成<code>Count = SEM_INIT_NUM - semCount</code>为<code>-1</code>了，但因为<code>Count</code>是<code>UINT32</code>，从而变成<code>0xFFFFFFFF</code>，一个极大值，造成for循环执行长时间不退出。修改方法是将<code>Count</code>的<code>UINT32</code>改成<code>SINT32</code>。这是一个非常低级的代码错误。</p>

<p>其实更简单的是删除信号量，重新创建信号量，这样代码会容易读的多。</p>

<p><code>
DeleteSemaphore(ptxSem);
ptxSem = CreateSemaphore(SEM_INIT_NUM);
</code></p>
]]></content>
  </entry>
  
</feed>
