
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>flask_twip在heroku上搭建教程 - xixitalk blog</title>
  <meta name="author" content="xixitalk">

  
  <meta name="description" content="flask_twip是@yegle写的一个可以搭建在heroku上的一个twip的port程序。 经@yegle提醒，flask_twip已经开发到0.0.5版本，支持SQLBackend存储，认证的token不会再丢失，所以本教程更新到flask_twip-0.0.5。 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://xixitalk.github.com/blog/2012/11/23/flask-twip-on-heroku">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="xixitalk blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-32324744-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">xixitalk blog</a></h1>
  
    <h2>xixitalk life</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:xixitalk.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/blog/categories/">Categories</a></li>
  <li><a href="/about/">About me</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Flask_twip在heroku上搭建教程</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-11-23T21:01:00+08:00" pubdate data-updated="true">Nov 23<span>rd</span>, 2012</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p><a href="https://github.com/yegle/flask_twip">flask_twip</a>是@<a href="http://twitter.com/yegle">yegle</a>写的一个可以搭建在<a href="http://www.heroku.com/">heroku</a>上的一个<a href="http://code.google.com/p/twip/">twip</a>的port程序。</p>

<p>经@yegle提醒，flask_twip已经开发到0.0.5版本，支持SQLBackend存储，认证的token不会再丢失，所以本教程更新到flask_twip-0.0.5。</p>

<p><del>
本教程使用的基于flask_twip-0.0.1的修改版本<a href="https://github.com/xixitalk/flask_twip/blob/master/release/flask_twip-0.0.1_mod.zip">flask_twip-0.0.1_mod.zip</a>，主要是因为原版本O模式认证后的token保存在文件里，而heroku的文件为临时文件（<a href="https://devcenter.heroku.com/articles/python-faq#can-i-read-from-and-write-to-the-file-system">ephemeral文件</a>），经过不到一天就会丢失，本修改将认证信息通过写代码里第二次上传来规避临时文件丢失，其次增加了gzip压缩支持。
</del></p>

<h2>准备工作</h2>

<p>1、注册heroku帐号,过程略。</p>

<p>2、在<a href="https://dev.twitter.com">https://dev.twitter.com</a>注册一个API的key，记录consumer key和consumer secret，下面会用到。 callback的url是</p>

<pre><code>https://APPNAME.herokuapp.com/twip/oauth/callback/
</code></pre>

<p>APPNAME是你heroku应用的名字。@yegle提醒说callback可以随便填写。</p>

<p>3、找一个linux机器，以下以ubuntu为例，windows没试过，windows很多命令工具没有，比如pip和virtualenv。 ubuntu用下面命令安装heroku工具，也可参见<a href="https://toolbelt.heroku.com/debian">https://toolbelt.heroku.com/debian</a></p>

<pre><code>wget -qO- https://toolbelt.heroku.com/install-ubuntu.sh | sh
</code></pre>

<p>有些命令如果系统没有安装单独用apt-get install安装，如git、virtualenv、pip。</p>

<h2>开始创建heroku应用</h2>

<p>以下步骤可以同步参考<a href="https://devcenter.heroku.com/articles/python">https://devcenter.heroku.com/articles/python</a></p>

<p>1、输入heroku帐号密码登录</p>

<pre><code>$heroku login
</code></pre>

<p>2、用下面命令创建一个目录，比如mytwip，并进入到mytwip目录里。以下命令都是在mytwip目录里进行的。</p>

<pre><code>$mkdir mytwip &amp;&amp; cd mytwip 
</code></pre>

<p>3、用下面命令在mytwip目录里创建一个虚拟化环境，mytwip目录里会出现一个venv的目录</p>

<pre><code>$virtualenv venv --distribute
</code></pre>

<p>4、用下面命令切换到虚拟化环境</p>

<pre><code>$source venv/bin/activate
</code></pre>

<p>命令提示符前增加了(venv)前缀，如(venv)xixitalk@ubuntu:~/mytwip$ 。</p>

<p>5、使用pip install安装Flask_Twip,自动会安装所有依赖。gunicorn需要单独安装。用$pip freeze看依赖安装情况。</p>

<pre><code>$pip install Flask_Twip
$pip install gunicorn
$pip freeze
</code></pre>

<p>依赖安装完整后，生成requirements.txt。</p>

<pre><code>$pip freeze &gt; requirements.txt
</code></pre>

<p>6、从<a href="https://github.com/yegle/flask_twip/tree/master/examples/heroku">https://github.com/yegle/flask_twip/tree/master/examples/heroku</a>下载Procfile、app.py到mytwip目录，从<a href="https://github.com/yegle/flask_twip/tree/master/examples">https://github.com/yegle/flask_twip/tree/master/examples</a>下载settings-example.py文件到mytwip目录，并重命名为settings.py。
修改settings.py里的TWITTER_CONSUMER_KEY和TWITTER_CONSUMER_SECRET值为准备工作第2步twitter API创建的值。<br/>
可以在<a href="https://github.com/yegle/flask_twip/tree/master/examples">https://github.com/yegle/flask_twip/tree/master/examples</a>页面点击右边中间的Downloads连接下载，蓝色History上面。把上面提到的三个文件挑出来放到步骤2创建的mytwip目录里。
用ls命令查看，现在mytwip有如下几个文件：</p>

<pre><code>(venv)xixitalk@ubuntu:~/mytwip$ ls
requirements.txt Procfile venv app.py  settings.py
</code></pre>

<p>7、Procfile设置跳过，上步已经下载。</p>

<p>8、$foreman start跳过，这里是本地试运行。</p>

<p>9、在mytwip目录下建一个.gitignore文件，表示venv目录和pyc文件不上传git服务器。</p>

<pre><code>venv
*.pyc
</code></pre>

<p>10、初始化mytwip目录的git环境。</p>

<pre><code>$git init 
$git add .
$git commit -m "init" 
</code></pre>

<p>11、创建应用,APPNAME为自定义名字。</p>

<pre><code>$heroku create APPNAME 
</code></pre>

<p>如果创建后想修改应用名字在mytwip目录用下面命令再修改，newname是自定义新应用名称。</p>

<pre><code>$heroku apps:rename newname
</code></pre>

<p>12、将应用上传到heroku的git服务器，应用自动运行。</p>

<pre><code>$git push heroku master 
</code></pre>

<p>13、浏览器访问https://APPNAME.herokuapp.com/twip/进行O模式认证,认证完API格式为：</p>

<pre><code>https://APPNAME.herokuapp.com/twip/TWITTER/KEY/
</code></pre>

<p>其中TWITTER为你的twitter用户名，KEY就是该API的key，API地址要保密,任何人通过这个地址都能访问你的twitter帐号。</p>

<p>14、如果https://APPNAME.herokuapp.com/twip/访问不正常，可以通过heroku的logs分析定位。</p>

<pre><code>$heroku logs
</code></pre>

<p>这样搭建全部完成，可以在支持twip O模式的客户端使用了，注意将API保持https方式，不然会被墙的。</p>

<pre><code>https://APPNAME.herokuapp.com/twip/TWITTER/KEY/
</code></pre>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">xixitalk</span></span>

      








  


<time datetime="2012-11-23T21:01:00+08:00" pubdate data-updated="true">Nov 23<span>rd</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/flask-twip/'>flask_twip</a>, <a class='category' href='/blog/categories/git/'>git</a>, <a class='category' href='/blog/categories/heroku/'>heroku</a>, <a class='category' href='/blog/categories/twip/'>twip</a>, <a class='category' href='/blog/categories/twitter/'>twitter</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2012/06/04/second/" title="Previous Post: second">&laquo; second</a>
      
      
        <a class="basic-alignment right" href="/blog/2012/11/23/octopress-command-note/" title="Next Post: octopress命令备忘录">octopress命令备忘录 &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Categories</h1>
    <ul id="category-list"><li><a href='/blog/categories/flask-twip'>flask_twip (1)</a></li><li><a href='/blog/categories/git'>git (3)</a></li><li><a href='/blog/categories/github'>github (1)</a></li><li><a href='/blog/categories/heroku'>heroku (1)</a></li><li><a href='/blog/categories/markdown'>markdown (1)</a></li><li><a href='/blog/categories/octopress'>octopress (1)</a></li><li><a href='/blog/categories/test'>test (2)</a></li><li><a href='/blog/categories/twip'>twip (1)</a></li><li><a href='/blog/categories/twitter'>twitter (1)</a></li></ul>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - xixitalk -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'gitblog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://xixitalk.github.com/blog/2012/11/23/flask-twip-on-heroku/';
        var disqus_url = 'http://xixitalk.github.com/blog/2012/11/23/flask-twip-on-heroku/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
